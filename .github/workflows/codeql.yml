name: "Security Overwatch Workflow"

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '23 15 * * 2'

jobs:
  security-checks:
    name: Run Security Scans
    runs-on: ubuntu-latest
    permissions:
      security-events: write
    container:
      image: debian:latest 
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install Dependencies
      run: |
        echo "Installing dependencies..."
        apt update && apt install -y shellcheck python3-pip
        python3 -m pip install --upgrade pip
        pip install pylint bandit trufflehog

    - name: Run Security Scanning Bash Script
      run: |
        # Exit immediately if a command exits with a non-zero status
        set -e

        echo "Running linting..."
        find . -type f -name "*.sh" -exec shellcheck {} \;
        find . -type f -name "*.py" -exec pylint {} \;

        echo "Running secret scanning..."
        trufflehog filesystem --path ./ --json

        echo "Running security flaw scanning..."
        bandit -r .

        echo "All checks completed successfully!"